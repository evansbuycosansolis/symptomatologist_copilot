(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{4860:(t,e,n)=>{"use strict";n.d(e,{XN:()=>g,_o:()=>h,b0:()=>d,je:()=>f,tk:()=>u});var a=n(5731);let o="copilot.portal.role",s="copilot.portal.login_at",l="copilot.portal.boot_cleaned";function i(t){return"doctor"===t||"assistant"===t}function r(t){window.localStorage.setItem(o,t),window.localStorage.setItem(s,new Date().toISOString())}function c(){window.localStorage.removeItem(o),window.localStorage.removeItem(s)}function u(t,e){let n=(e||"").toLowerCase().replace(/[^a-z]/g,"");return"doctor"===n?"doctor"===t?"/doctor/":"/assistant/":"assistant"===n?"/assistant/":"doctor"===t?"/doctor/":"/assistant/"}async function d(){try{let t=await (0,a.Tt)("/auth/session"),e=i(null==t?void 0:t.role)?t.role:null;if((null==t?void 0:t.authenticated)&&e)return r(e),e;return c(),null}catch(t){return c(),null}}async function h(t,e){let n=await (0,a.B2)("/auth/login",{role:t,pin:e}),o=i(null==n?void 0:n.role)?n.role:null;if(!(null==n?void 0:n.authenticated)||!o)throw Error("Login failed.");return r(o),o}async function f(t){let e=!!(null==t?void 0:t.force),n="1"===window.sessionStorage.getItem(l);if(e||!n){window.sessionStorage.setItem(l,"1");try{await (0,a.B2)("/auth/logout",{})}finally{c()}}}async function g(){try{await (0,a.B2)("/auth/logout",{})}finally{c()}}},5695:(t,e,n)=>{"use strict";var a=n(8999);n.o(a,"useRouter")&&n.d(e,{useRouter:function(){return a.useRouter}})},5731:(t,e,n)=>{"use strict";n.d(e,{B2:()=>i,Tt:()=>l,pb:()=>r,zz:()=>c});var a=n(9509);let o=function(){var t;let e=(a.env.NEXT_PUBLIC_API_BASE_URL||"").trim();if(e)return e.replace(/\/+$/,"");if(null==(t=window.location)?void 0:t.origin){let{origin:t,hostname:e,port:n}=window.location;return("localhost"===e||"127.0.0.1"===e)&&"3000"===n?"http://".concat(e,":8080"):t}return"http://127.0.0.1:8080"}();async function s(t){if(!t.ok){let e="".concat(t.status," ").concat(t.statusText);try{let n=await t.json();(null==n?void 0:n.detail)&&(e=String(n.detail))}catch(t){}throw Error(e)}return await t.json()}async function l(t){return s(await fetch("".concat(o).concat(t),{cache:"no-store",credentials:"include"}))}async function i(t,e){return s(await fetch("".concat(o).concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"}))}async function r(t,e){return s(await fetch("".concat(o).concat(t),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"}))}async function c(t,e){return s(await fetch("".concat(o).concat(t),{method:"POST",body:e,credentials:"include"}))}},9138:(t,e,n)=>{Promise.resolve().then(n.bind(n,9690))},9690:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>c});var a=n(5155),o=n(6874),s=n.n(o),l=n(5695),i=n(2115),r=n(4860);function c(){let t=(0,l.useRouter)(),[e,n]=(0,i.useState)(null),[o,c]=(0,i.useState)(null),[u,d]=(0,i.useState)(""),[h,f]=(0,i.useState)(""),[g,w]=(0,i.useState)(null),[m,p]=(0,i.useState)(null),y=(0,i.useRef)(null);(0,i.useEffect)(()=>{let e=!1;return(async()=>{let a=new URLSearchParams(window.location.search),o=a.get("next"),s=a.get("blocked"),l=(a.get("fresh")||"").trim().toLowerCase(),i="1"===l||"true"===l||"yes"===l;if(n(o),c(s),await (0,r.je)({force:i}),i&&!e){let t=new URLSearchParams(a);t.delete("fresh");let e=t.toString()?"/login/?".concat(t):"/login/";window.history.replaceState(null,"",e)}let u=await (0,r.b0)();if(!e){if(u)return t.replace((0,r.tk)(u,o));p(u)}})(),()=>{e=!0}},[t]);let S=(0,i.useMemo)(()=>"doctor"===o?"Doctor workspace is restricted for assistant accounts.":"doctor"===e?"Sign in as Doctor to open Medical Doctor Workspace.":"assistant"===e?"Sign in to continue to Medical Assistant Portal.":"Select your portal access role.",[o,e]),v=n=>{var a,o;f(""),w(n);let s=(null!=(o=null==(a=y.current)?void 0:a.value)?o:u).trim();(async()=>{try{let a=await (0,r._o)(n,s);p(a),t.replace((0,r.tk)(a,e))}catch(t){f(t instanceof Error?t.message:"Login failed.")}finally{w(null)}})()};return(0,a.jsxs)("main",{className:"shell stack","data-testid":"login-page",children:[(0,a.jsxs)("section",{className:"hero",children:[(0,a.jsx)("h1",{className:"doctor-hero-title",children:"Portal Login"}),(0,a.jsx)("p",{children:S}),(0,a.jsxs)("nav",{className:"hero-nav",children:[(0,a.jsx)(s(),{href:"/",children:"Home"}),(0,a.jsx)(s(),{href:"/assistant",children:"Assistant"}),(0,a.jsx)(s(),{href:"/doctor",children:"Doctor"})]})]}),(0,a.jsxs)("section",{className:"panel stack",children:[(0,a.jsxs)("div",{className:"field",style:{maxWidth:360},children:[(0,a.jsx)("label",{htmlFor:"loginPin",children:"PIN"}),(0,a.jsx)("input",{id:"loginPin","data-testid":"login-pin-input",type:"password",ref:y,value:u,onChange:t=>d(t.target.value),placeholder:"Enter role PIN"})]}),(0,a.jsxs)("div",{className:"toolbar",children:[(0,a.jsx)("button",{className:"btn primary","data-testid":"login-as-assistant",disabled:null!==g,onClick:()=>v("assistant"),children:"assistant"===g?"Logging in...":"Login as Medical Assistant"}),(0,a.jsx)("button",{className:"btn accent","data-testid":"login-as-doctor",disabled:null!==g,onClick:()=>v("doctor"),children:"doctor"===g?"Logging in...":"Login as Doctor"}),(0,a.jsx)("button",{className:"btn ghost","data-testid":"login-clear-session",disabled:null!==g,onClick:()=>{f(""),w("assistant"),(async()=>{try{await (0,r.XN)(),p(null),window.history.replaceState(null,"","/login/")}catch(t){f(t instanceof Error?t.message:"Logout failed.")}finally{w(null)}})()},children:"Clear session"})]}),h?(0,a.jsx)("p",{className:"small-meta","data-testid":"login-error",style:{color:"#a11818"},children:h}):null,(0,a.jsxs)("p",{className:"small-meta","data-testid":"login-current-role",children:["Current role: ",m||"none"]})]})]})}}},t=>{var e=e=>t(t.s=e);t.O(0,[874,441,684,358],()=>e(9138)),_N_E=t.O()}]);