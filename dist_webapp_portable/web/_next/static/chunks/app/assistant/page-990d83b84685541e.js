(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[125],{382:(e,t,a)=>{"use strict";a.d(t,{PortalCard:()=>o,Z:()=>l,r:()=>r});var i=a(5155),n=a(6874),s=a.n(n);function l(e){let{title:t,subtitle:a,className:n="",children:s}=e;return(0,i.jsxs)("section",{className:"panel ".concat(n).trim(),children:[(t||a)&&(0,i.jsxs)("header",{className:"panel-header",children:[t?(0,i.jsx)("h2",{children:t}):null,a?(0,i.jsx)("p",{children:a}):null]}),s]})}function o(e){return(0,i.jsxs)(s(),{className:"portal-card",href:e.href,style:{"--accent":e.accent},children:[(0,i.jsx)("div",{className:"portal-card__bar"}),(0,i.jsx)("h3",{children:e.title}),(0,i.jsx)("p",{children:e.description}),(0,i.jsx)("span",{className:"portal-card__cta",children:"Open workspace"})]})}function r(e){let{children:t}=e;return(0,i.jsx)("p",{className:"small-meta",children:t})}},4391:(e,t,a)=>{Promise.resolve().then(a.bind(a,8617))},4860:(e,t,a)=>{"use strict";a.d(t,{XN:()=>p,_o:()=>u,b0:()=>m,je:()=>h,tk:()=>c});var i=a(5731);let n="copilot.portal.role",s="copilot.portal.login_at",l="copilot.portal.boot_cleaned";function o(e){return"doctor"===e||"assistant"===e}function r(e){window.localStorage.setItem(n,e),window.localStorage.setItem(s,new Date().toISOString())}function d(){window.localStorage.removeItem(n),window.localStorage.removeItem(s)}function c(e,t){let a=(t||"").toLowerCase().replace(/[^a-z]/g,"");return"doctor"===a?"doctor"===e?"/doctor/":"/assistant/":"assistant"===a?"/assistant/":"doctor"===e?"/doctor/":"/assistant/"}async function m(){try{let e=await (0,i.Tt)("/auth/session"),t=o(null==e?void 0:e.role)?e.role:null;if((null==e?void 0:e.authenticated)&&t)return r(t),t;return d(),null}catch(e){return d(),null}}async function u(e,t){let a=await (0,i.B2)("/auth/login",{role:e,pin:t}),n=o(null==a?void 0:a.role)?a.role:null;if(!(null==a?void 0:a.authenticated)||!n)throw Error("Login failed.");return r(n),n}async function h(e){let t=!!(null==e?void 0:e.force),a="1"===window.sessionStorage.getItem(l);if(t||!a){window.sessionStorage.setItem(l,"1");try{await (0,i.B2)("/auth/logout",{})}finally{d()}}}async function p(){try{await (0,i.B2)("/auth/logout",{})}finally{d()}}},5695:(e,t,a)=>{"use strict";var i=a(8999);a.o(i,"useRouter")&&a.d(t,{useRouter:function(){return i.useRouter}})},5731:(e,t,a)=>{"use strict";a.d(t,{B2:()=>o,Tt:()=>l,pb:()=>r,zz:()=>d});var i=a(9509);let n=function(){var e;let t=(i.env.NEXT_PUBLIC_API_BASE_URL||"").trim();if(t)return t.replace(/\/+$/,"");if(null==(e=window.location)?void 0:e.origin){let{origin:e,hostname:t,port:a}=window.location;return("localhost"===t||"127.0.0.1"===t)&&"3000"===a?"http://".concat(t,":8080"):e}return"http://127.0.0.1:8080"}();async function s(e){if(!e.ok){let t="".concat(e.status," ").concat(e.statusText);try{let a=await e.json();(null==a?void 0:a.detail)&&(t=String(a.detail))}catch(e){}throw Error(t)}return await e.json()}async function l(e){return s(await fetch("".concat(n).concat(e),{cache:"no-store",credentials:"include"}))}async function o(e,t){return s(await fetch("".concat(n).concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"}))}async function r(e,t){return s(await fetch("".concat(n).concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"}))}async function d(e,t){return s(await fetch("".concat(n).concat(e),{method:"POST",body:t,credentials:"include"}))}},8617:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var i=a(5155),n=a(382),s=a(5731);let l={FullName:"",DateOfBirth:"",Gender:"",Address:"",PhoneNumber:"",Email:"",ContactPerson:"",ContactNumber:"",BloodPressure:"",HeartRate:"",RespiratoryRate:"",Temperature:"",SpO2:"",Height:"",Weight:"",BMI:"",ChiefComplaint:"",OnsetDate:"",Duration:"",Severity:"",Location:"",AssociatedSymptoms:"",Medications:"",OTCMeds:"",Supplements:"",SmokingStatus:"",AlcoholUse:"",DrugUse:"",Allergies:"",NotableFamilyMedicalHistory:"",PastMedicalHistory:"",ImmunizationHistory:"",LastClinicVisitNotes:"",MedicalAssistantNotes:"",AdditionalDemographicsNotes:"",AdditionalVitalNotes:"",AdditionalHistoryNotes:"",AdditionalMedicationNotes:"",AdditionalSocialNotes:"",AdditionalAllergyNotes:"",AdditionalFamilyHistoryNotes:"",AdditionalPastMedicalNotes:"",AdditionalImmunizationNotes:"",AdditionalLastClinicVisitNotes:"",AdditionalMedicalAssistantNotes:"",LabExtractedText1:"",LabExtractedText2:"",LabExtractedText3:"",LabExtractedText4:"",LabExtractedText5:"",LabExtractedText6:""};var o=a(6874),r=a.n(o),d=a(5695),c=a(2115),m=a(4860);let u=[{key:"FullName",label:"Full name"},{key:"DateOfBirth",label:"Date of birth"},{key:"Gender",label:"Gender"},{key:"Address",label:"Address"},{key:"PhoneNumber",label:"Phone number"},{key:"Email",label:"Email"},{key:"ContactPerson",label:"Emergency contact person"},{key:"ContactNumber",label:"Emergency contact number"}],h=[{key:"BloodPressure",label:"Blood pressure"},{key:"HeartRate",label:"Heart rate"},{key:"RespiratoryRate",label:"Respiratory rate"},{key:"Temperature",label:"Temperature"},{key:"SpO2",label:"SpO2"},{key:"Height",label:"Height"},{key:"Weight",label:"Weight"},{key:"BMI",label:"BMI"}],p=[{key:"ChiefComplaint",label:"Chief complaint"},{key:"OnsetDate",label:"Onset date/time"},{key:"Duration",label:"Duration"},{key:"Severity",label:"Severity"},{key:"Location",label:"Location"},{key:"AssociatedSymptoms",label:"Associated symptoms"}],y=[{key:"Medications",label:"Prescription meds"},{key:"OTCMeds",label:"OTC meds"},{key:"Supplements",label:"Supplements"},{key:"SmokingStatus",label:"Smoking status"},{key:"AlcoholUse",label:"Alcohol use"},{key:"DrugUse",label:"Drug use"}],b=[{key:"Allergies",label:"Allergies"},{key:"NotableFamilyMedicalHistory",label:"Family history"},{key:"PastMedicalHistory",label:"Past medical history"},{key:"ImmunizationHistory",label:"Immunization history"},{key:"LastClinicVisitNotes",label:"Last clinic visit notes"},{key:"MedicalAssistantNotes",label:"Medical assistant notes"}],x=[{key:"AdditionalDemographicsNotes",label:"Additional demographics notes"},{key:"AdditionalVitalNotes",label:"Additional vital notes"},{key:"AdditionalHistoryNotes",label:"Additional history notes"},{key:"AdditionalMedicationNotes",label:"Additional medication notes"},{key:"AdditionalSocialNotes",label:"Additional social notes"},{key:"AdditionalAllergyNotes",label:"Additional allergy notes"},{key:"AdditionalFamilyHistoryNotes",label:"Additional family history notes"},{key:"AdditionalPastMedicalNotes",label:"Additional past medical notes"},{key:"AdditionalImmunizationNotes",label:"Additional immunization notes"},{key:"AdditionalLastClinicVisitNotes",label:"Additional last-clinic notes"},{key:"AdditionalMedicalAssistantNotes",label:"Additional MA notes"}],f=["LabExtractedText1","LabExtractedText2","LabExtractedText3","LabExtractedText4","LabExtractedText5","LabExtractedText6"];function g(){let e=(0,d.useRouter)(),[t,a]=(0,c.useState)(l),[o,g]=(0,c.useState)(""),[v,N]=(0,c.useState)([]),[k,j]=(0,c.useState)("Ready."),[w,A]=(0,c.useState)(""),[C,P]=(0,c.useTransition)(),[S,F]=(0,c.useState)(null),[D,_]=(0,c.useState)(!1),[E,T]=(0,c.useState)(()=>new Date().toISOString().slice(0,10)),[L,M]=(0,c.useState)("09:00"),[O,R]=(0,c.useState)(30),[H,I]=(0,c.useState)(""),[B,U]=(0,c.useState)(""),[V,z]=(0,c.useState)(!0),[G,Z]=(0,c.useState)(null),[W,q]=(0,c.useState)(!1),[J,X]=(0,c.useState)(null),$=(0,c.useRef)(null);(0,c.useEffect)(()=>{let t=!1;return(async()=>{if(await (0,m.je)(),t)return;let a=await (0,m.b0)();if(!t){if(!a)return e.replace("/login/?next=assistant");Z(a),q(!0)}})(),()=>{t=!0}},[e]),(0,c.useEffect)(()=>{"doctor_locked"===(new URLSearchParams(window.location.search).get("notice")||"").toLowerCase()&&j("Doctor workspace is restricted for assistant accounts.")},[]);let K=(e,t)=>a(a=>({...a,[e]:t})),Q=async()=>{_(!0),A("");try{var e,t,a;let i=await (0,s.Tt)("/intakes");N(null!=(t=i.items)?t:[]),j("Loaded ".concat(null!=(a=null==(e=i.items)?void 0:e.length)?a:0," intake record(s)."))}catch(e){A(e instanceof Error?e.message:"Failed to load records.")}finally{_(!1)}},Y=async e=>{A(""),j("Preparing patient PDF for record ".concat(e,"..."));try{var t,i,n;let o=await (0,s.Tt)("/intakes/".concat(e)),r={...l,...null!=(i=o.intake)?i:{}},d=null!=(n=o.enhanced_report)?n:"";a(r),g(d);let c=r.FullName.trim()||(null==(t=o.meta)?void 0:t.full_name)||"Patient";try{let e=await (0,s.B2)("/documents/intake_pdf",{intake:r,enhanced_report:d,title:"Patient Record - ".concat(c)});ea(e.document.stored_path,e.document.filename||"Patient record PDF"),j("Opened patient PDF: ".concat(e.document.filename))}catch(e){j("Patient PDF is unavailable in this build. Intake loaded into form."),A(""),console.warn("intake_pdf generation failed",e)}}catch(e){A(e instanceof Error?e.message:"Failed to open patient PDF.")}},ee=async(e,a)=>{F(e),A(""),j("Uploading lab file ".concat(e,"..."));try{let i=new FormData;i.append("file",a),i.append("patient_name",t.FullName.trim()),i.append("patient_dob",t.DateOfBirth.trim()),i.append("lab_slot",String(e));let n=await (0,s.zz)("/attachments/extract",i),l=f[e-1];l&&K(l,n.extracted_text||n.message||""),j(n.extracted_text?"Lab file ".concat(e," uploaded and text extracted."):"Lab file ".concat(e," uploaded."))}catch(e){A(e instanceof Error?e.message:"Lab upload failed.")}finally{F(null)}},et=e=>{let t=(e||"").trim();return t?t.startsWith("/")?t:"/storage/".concat(t.replace(/^\/+/,"")):""},ea=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Patient document",a=et(e);a&&X({url:a,title:t})};return W?(0,i.jsxs)("main",{className:"shell stack","data-testid":"assistant-page",children:[(0,i.jsxs)("section",{className:"hero",children:[(0,i.jsx)("h1",{className:"assistant-hero-title",children:"Medical Assistant Portal"}),(0,i.jsx)("p",{children:"Front-desk and intake workspace for medical assistants: register patient demographics, encode vitals and complaints, upload lab/image files for text extraction, generate intake summaries, and forward complete records to the doctor for clinical review."}),(0,i.jsxs)("nav",{className:"hero-nav",children:[(0,i.jsx)(r(),{href:"/",children:"Home"}),"doctor"===G?(0,i.jsx)(r(),{href:"/doctor",children:"Doctor Workspace"}):(0,i.jsx)("button",{className:"nav-chip-btn",type:"button",disabled:!0,title:"Doctor login required",children:"Doctor Workspace (Doctor only)"}),(0,i.jsx)("button",{className:"nav-chip-btn",type:"button","data-testid":"assistant-logout",onClick:()=>{A(""),j("Signing out..."),P(async()=>{try{await (0,m.XN)()}finally{e.replace("/login/?fresh=1")}})},disabled:C,children:"Logout"}),(0,i.jsx)("button",{className:"nav-chip-btn","data-testid":"assistant-refresh-records",onClick:()=>void Q(),children:D?"Refreshing...":"Refresh recent records"})]})]}),(0,i.jsxs)("div",{className:"page-grid columns-2",children:[(0,i.jsxs)(n.Z,{title:"Patient Demographics",subtitle:"Matches legacy intake fields",children:[(0,i.jsx)("div",{className:"field-grid",children:u.map(e=>(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{htmlFor:e.key,children:e.label}),(0,i.jsx)("input",{id:e.key,"data-testid":"assistant-".concat(e.key),value:t[e.key],onChange:t=>K(e.key,t.target.value)})]},e.key))}),(0,i.jsxs)("div",{className:"field",style:{marginTop:12},children:[(0,i.jsx)("label",{htmlFor:"AdditionalDemographicsNotes",children:"Additional demographics notes"}),(0,i.jsx)("textarea",{id:"AdditionalDemographicsNotes","data-testid":"assistant-AdditionalDemographicsNotes",value:t.AdditionalDemographicsNotes,onChange:e=>K("AdditionalDemographicsNotes",e.target.value)})]})]}),(0,i.jsxs)(n.Z,{title:"Vitals and Chief Complaint",children:[(0,i.jsx)("div",{className:"field-grid compact-3",children:h.map(e=>(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{htmlFor:e.key,children:e.label}),(0,i.jsx)("input",{id:e.key,"data-testid":"assistant-".concat(e.key),value:t[e.key],onChange:t=>K(e.key,t.target.value)})]},e.key))}),(0,i.jsxs)("div",{className:"field",style:{marginTop:12},children:[(0,i.jsx)("label",{htmlFor:"AdditionalVitalNotes",children:"Additional vital notes"}),(0,i.jsx)("textarea",{id:"AdditionalVitalNotes","data-testid":"assistant-AdditionalVitalNotes",value:t.AdditionalVitalNotes,onChange:e=>K("AdditionalVitalNotes",e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{htmlFor:"ChiefComplaint",children:"Chief complaint"}),(0,i.jsx)("textarea",{id:"ChiefComplaint","data-testid":"assistant-ChiefComplaint",value:t.ChiefComplaint,onChange:e=>K("ChiefComplaint",e.target.value)})]})]}),(0,i.jsxs)(n.Z,{title:"History, Medications, Social",children:[(0,i.jsx)("div",{className:"field-grid",children:[...p.filter(e=>"ChiefComplaint"!==e.key),...y].map(e=>(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{htmlFor:e.key,children:e.label}),(0,i.jsx)("input",{id:e.key,"data-testid":"assistant-".concat(e.key),value:t[e.key],onChange:t=>K(e.key,t.target.value)})]},e.key))}),(0,i.jsxs)("div",{className:"field",style:{marginTop:12},children:[(0,i.jsx)("label",{htmlFor:"AdditionalHistoryNotes",children:"Additional history notes"}),(0,i.jsx)("textarea",{id:"AdditionalHistoryNotes","data-testid":"assistant-AdditionalHistoryNotes",value:t.AdditionalHistoryNotes,onChange:e=>K("AdditionalHistoryNotes",e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{htmlFor:"AdditionalMedicationNotes",children:"Additional medication notes"}),(0,i.jsx)("textarea",{id:"AdditionalMedicationNotes","data-testid":"assistant-AdditionalMedicationNotes",value:t.AdditionalMedicationNotes,onChange:e=>K("AdditionalMedicationNotes",e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{htmlFor:"AdditionalSocialNotes",children:"Additional social notes"}),(0,i.jsx)("textarea",{id:"AdditionalSocialNotes","data-testid":"assistant-AdditionalSocialNotes",value:t.AdditionalSocialNotes,onChange:e=>K("AdditionalSocialNotes",e.target.value)})]})]}),(0,i.jsxs)(n.Z,{title:"Allergies, Family/Past History, Notes",children:[(0,i.jsx)("div",{className:"field-grid",children:b.map(e=>(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{htmlFor:e.key,children:e.label}),(0,i.jsx)("textarea",{id:e.key,"data-testid":"assistant-".concat(e.key),value:t[e.key],onChange:t=>K(e.key,t.target.value)})]},e.key))}),(0,i.jsx)("div",{className:"field-grid",children:x.slice(5).map(e=>(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{htmlFor:e.key,children:e.label}),(0,i.jsx)("textarea",{id:e.key,"data-testid":"assistant-".concat(e.key),value:t[e.key],onChange:t=>K(e.key,t.target.value)})]},e.key))})]})]}),(0,i.jsxs)("div",{className:"page-grid columns-2",children:[(0,i.jsx)(n.Z,{title:"Lab Results (1-6)",subtitle:"Upload image/PDF or paste extracted text manually",children:(0,i.jsx)("div",{className:"stack",children:f.map((e,a)=>(0,i.jsxs)("div",{className:"panel",style:{padding:"0.75rem"},children:[(0,i.jsxs)("div",{className:"toolbar",style:{justifyContent:"space-between"},children:[(0,i.jsxs)("strong",{children:["Lab Result ",a+1]}),(0,i.jsxs)("label",{className:"btn ghost",style:{cursor:"pointer"},children:[S===a+1?"Uploading...":"Upload file",(0,i.jsx)("input",{type:"file","data-testid":"assistant-lab-upload-".concat(a+1),accept:"image/*,.pdf,application/pdf",hidden:!0,onChange:e=>{var t;let i=null==(t=e.target.files)?void 0:t[0];i&&ee(a+1,i),e.currentTarget.value=""}})]})]}),(0,i.jsx)("textarea",{"data-testid":"assistant-lab-text-".concat(a+1),value:t[e],onChange:t=>K(e,t.target.value),placeholder:"Lab extracted text ".concat(a+1)})]},e))})}),(0,i.jsxs)(n.Z,{title:"Actions and Output",children:[(0,i.jsxs)("div",{className:"toolbar",children:[(0,i.jsx)("button",{className:"btn primary","data-testid":"assistant-save-intake",disabled:C,onClick:()=>{A(""),j("Saving intake record..."),P(async()=>{try{var e,a,i;let n=await (0,s.B2)("/intakes",{intake:t,generate_enhanced_report:!0});g(null!=(a=n.enhanced_report)?a:o),j("Saved intake record ".concat(null!=(i=null==(e=n.record)?void 0:e.id)?i:"",".")),Q()}catch(e){A(e instanceof Error?e.message:"Save failed.")}})},children:C?"Working...":"Save Intake + Generate Report"}),(0,i.jsx)("button",{className:"btn accent","data-testid":"assistant-generate-enhanced",disabled:C,onClick:()=>{A(""),j("Generating enhanced intake report..."),P(async()=>{try{var e;let a=await (0,s.B2)("/enhance-patient-report",t);g(null!=(e=a.enhanced_report)?e:""),j("Enhanced report generated.")}catch(e){A(e instanceof Error?e.message:"Enhance failed.")}})},children:"Generate Enhanced Report Only"}),(0,i.jsx)("button",{className:"btn","data-testid":"assistant-generate-patient-pdf",disabled:C,onClick:()=>{let e=t.FullName.trim();if(!e)return void A("Patient full name is required to generate a patient record PDF.");A(""),j("Generating patient record PDF..."),P(async()=>{try{let a=await (0,s.B2)("/documents/intake_pdf",{intake:t,enhanced_report:o,title:"Patient Record - ".concat(e)});j("Patient record PDF ready: ".concat(a.document.filename)),ea(a.document.stored_path,a.document.filename||"Patient record PDF")}catch(e){A(e instanceof Error?e.message:"Failed to generate patient record PDF.")}})},children:"Generate Patient Record PDF"}),(0,i.jsx)("button",{className:"btn","data-testid":"assistant-generate-certificate-pdf",disabled:C,onClick:()=>{var e,a,i,n;let l=t.FullName.trim();if(!l)return void A("Patient full name is required to generate a medical certificate.");let o=null!=(e=window.prompt("Diagnosis / impression",t.ChiefComplaint||""))?e:"",r=null!=(a=window.prompt("Recommendations","Patient is advised to follow medical advice and rest."))?a:"",d=window.prompt("Rest days (optional integer)","1"),c=null!=(i=window.prompt("Doctor name",""))?i:"",m=null!=(n=window.prompt("Clinic / facility name",""))?n:"",u=d&&/^\d+$/.test(d.trim())?Number(d.trim()):null;A(""),j("Generating medical certificate PDF..."),P(async()=>{try{let e=await (0,s.B2)("/documents/medical_certificate_pdf",{patient_name:l,patient_dob:t.DateOfBirth.trim(),diagnosis:o,recommendations:r,rest_days:u,doctor_name:c,clinic_name:m,additional_notes:t.MedicalAssistantNotes||""});j("Medical certificate PDF ready: ".concat(e.document.filename)),ea(e.document.stored_path,e.document.filename||"Medical certificate PDF")}catch(e){A(e instanceof Error?e.message:"Failed to generate medical certificate PDF.")}})},children:"Generate Medical Certificate PDF"}),(0,i.jsx)("button",{className:"btn","data-testid":"assistant-clear-form",onClick:()=>{(0,c.startTransition)(()=>{a(l),g(""),j("Form cleared."),A("")})},children:"Clear Form"})]}),(0,i.jsx)("div",{className:"status".concat(w?" error":""),"data-testid":"assistant-status",children:w||k}),(0,i.jsxs)(n.r,{children:["The backend stores intakes under ",(0,i.jsx)("code",{children:"backend/storage/webapp/intakes"}),"."]}),(0,i.jsx)("div",{className:"pre","data-testid":"assistant-enhanced-report",children:o||"Enhanced report output will appear here."})]})]}),(0,i.jsxs)(n.Z,{title:"Appointment Scheduling",subtitle:"Assistant can set patient appointments on host",children:[(0,i.jsxs)("div",{className:"field-grid",children:[(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Patient name (from intake)"}),(0,i.jsx)("input",{"data-testid":"assistant-appt-patient-name",value:t.FullName,onChange:e=>K("FullName",e.target.value),placeholder:"Patient full name"})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Patient email"}),(0,i.jsx)("input",{"data-testid":"assistant-appt-email",value:t.Email,onChange:e=>K("Email",e.target.value),placeholder:"patient@example.com"})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Patient phone"}),(0,i.jsx)("input",{"data-testid":"assistant-appt-phone",value:t.PhoneNumber,onChange:e=>K("PhoneNumber",e.target.value),placeholder:"Phone number"})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Date"}),(0,i.jsx)("input",{type:"date","data-testid":"assistant-appt-date",value:E,onChange:e=>T(e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Time"}),(0,i.jsx)("input",{type:"time","data-testid":"assistant-appt-time",value:L,onChange:e=>M(e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Duration (minutes)"}),(0,i.jsx)("select",{"data-testid":"assistant-appt-duration",value:O,onChange:e=>R(Number(e.target.value)),children:[15,30,45,60].map(e=>(0,i.jsx)("option",{value:e,children:e},e))})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Reason"}),(0,i.jsx)("input",{"data-testid":"assistant-appt-reason",value:H,onChange:e=>I(e.target.value),placeholder:t.ChiefComplaint||"Chief complaint / reason"})]})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Scheduling notes"}),(0,i.jsx)("textarea",{"data-testid":"assistant-appt-notes",value:B,onChange:e=>U(e.target.value),placeholder:t.MedicalAssistantNotes||"Optional notes"})]}),(0,i.jsxs)("div",{className:"toolbar",children:[(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)("input",{type:"checkbox","data-testid":"assistant-appt-allow-waitlist",checked:V,onChange:e=>z(e.target.checked)}),"Add to waitlist if slot is full"]}),(0,i.jsx)("button",{className:"btn primary","data-testid":"assistant-set-appointment",disabled:C,onClick:()=>{let e=t.FullName.trim();if(!e)return void A("Full name is required before setting an appointment.");let a=(H||t.ChiefComplaint||"").trim(),i=(B||t.MedicalAssistantNotes||"").trim(),n=new Date("".concat(E,"T").concat(L)).toISOString();A(""),j("Creating appointment..."),P(async()=>{try{let o=await (0,s.B2)("/appointments",{patient_name:e,patient_email:t.Email.trim(),patient_phone:t.PhoneNumber.trim(),reason:a,notes:i,start_time:n,duration_minutes:O,allow_waitlist:V});if(o.waitlisted)j("Appointment slot unavailable. Patient added to waitlist.");else{var l;j("Appointment set".concat((null==(l=o.appointment)?void 0:l.id)?" (".concat(o.appointment.id,")"):"","."))}}catch(e){A(e instanceof Error?e.message:"Failed to create appointment.")}})},children:"Set Appointment"})]})]}),(0,i.jsx)(n.Z,{title:"Recent Intake Records",subtitle:"Load previously saved intake JSON + enhanced report",children:(0,i.jsx)("div",{className:"list","data-testid":"assistant-recent-list",children:0===v.length?(0,i.jsx)("div",{className:"list-item",children:(0,i.jsx)(n.r,{children:'No records loaded yet. Click "Refresh recent records".'})}):v.map(e=>(0,i.jsxs)("div",{className:"list-item","data-testid":"assistant-recent-item",children:[(0,i.jsx)("strong",{children:e.full_name||"(Unnamed patient)"}),(0,i.jsxs)(n.r,{children:["DOB: ",e.date_of_birth||"-"," | Complaint: ",e.chief_complaint||"-"]}),(0,i.jsx)(n.r,{children:e.created_at}),(0,i.jsx)("button",{className:"btn","data-testid":"assistant-load-intake-".concat(e.id),onClick:()=>void Y(e.id),children:"Open patient PDF"})]},e.id))})}),(0,i.jsx)(n.Z,{title:"Document Viewer + Print",subtitle:"Preview generated documents and print from browser",children:J?(0,i.jsxs)("div",{className:"stack",style:{gap:10},"data-testid":"assistant-document-viewer",children:[(0,i.jsx)(n.r,{children:J.title}),(0,i.jsxs)("div",{className:"toolbar",children:[(0,i.jsx)("button",{className:"btn primary","data-testid":"assistant-document-print",onClick:()=>{let e=$.current;try{var t,a;null==e||null==(t=e.contentWindow)||t.focus(),null==e||null==(a=e.contentWindow)||a.print();return}catch(e){}(null==J?void 0:J.url)&&(window.open(J.url,"_blank","noopener,noreferrer"),j("Opened document in a new tab. Use browser print there."))},children:"Print"}),(0,i.jsx)("button",{className:"btn","data-testid":"assistant-document-open-new-tab",onClick:()=>{(null==J?void 0:J.url)&&window.open(J.url,"_blank","noopener,noreferrer")},children:"Open in new tab"}),(0,i.jsx)("button",{className:"btn danger","data-testid":"assistant-document-close-viewer",onClick:()=>X(null),children:"Close viewer"})]}),(0,i.jsx)("iframe",{ref:$,src:J.url,title:J.title,style:{width:"100%",minHeight:560,border:"1px solid rgba(16, 32, 25, 0.14)",borderRadius:12,background:"white"}}),(0,i.jsx)(n.r,{children:'If preview is blocked by browser/PDF plugin, click "Open in new tab" then print there.'})]}):(0,i.jsx)(n.r,{children:"Open any patient PDF/certificate to preview and print it here."})})]}):(0,i.jsx)("main",{className:"shell",children:(0,i.jsx)("section",{className:"panel",children:(0,i.jsx)("p",{className:"small-meta",children:"Checking access..."})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[874,441,684,358],()=>t(4391)),_N_E=e.O()}]);