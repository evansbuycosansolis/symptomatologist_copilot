(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[328],{382:(e,t,a)=>{"use strict";a.d(t,{PortalCard:()=>r,Z:()=>l,r:()=>c});var i=a(5155),n=a(6874),s=a.n(n);function l(e){let{title:t,subtitle:a,className:n="",children:s}=e;return(0,i.jsxs)("section",{className:"panel ".concat(n).trim(),children:[(t||a)&&(0,i.jsxs)("header",{className:"panel-header",children:[t?(0,i.jsx)("h2",{children:t}):null,a?(0,i.jsx)("p",{children:a}):null]}),s]})}function r(e){return(0,i.jsxs)(s(),{className:"portal-card",href:e.href,style:{"--accent":e.accent},children:[(0,i.jsx)("div",{className:"portal-card__bar"}),(0,i.jsx)("h3",{children:e.title}),(0,i.jsx)("p",{children:e.description}),(0,i.jsx)("span",{className:"portal-card__cta",children:"Open workspace"})]})}function c(e){let{children:t}=e;return(0,i.jsx)("p",{className:"small-meta",children:t})}},4872:(e,t,a)=>{Promise.resolve().then(a.bind(a,7562))},5731:(e,t,a)=>{"use strict";a.d(t,{B2:()=>r,Tt:()=>l,pb:()=>c,zz:()=>d});var i=a(9509);let n=function(){var e;let t=(i.env.NEXT_PUBLIC_API_BASE_URL||"").trim();if(t)return t.replace(/\/+$/,"");if(null==(e=window.location)?void 0:e.origin){let e=window.location.origin;return("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)&&"3000"===window.location.port?"http://127.0.0.1:8080":e}return"http://127.0.0.1:8080"}();async function s(e){if(!e.ok){let t="".concat(e.status," ").concat(e.statusText);try{let a=await e.json();(null==a?void 0:a.detail)&&(t=String(a.detail))}catch(e){}throw Error(t)}return await e.json()}async function l(e){return s(await fetch("".concat(n).concat(e),{cache:"no-store"}))}async function r(e,t){return s(await fetch("".concat(n).concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}async function c(e,t){return s(await fetch("".concat(n).concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}async function d(e,t){return s(await fetch("".concat(n).concat(e),{method:"POST",body:t}))}},7562:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var i=a(5155),n=a(382),s=a(5731),l=a(6874),r=a.n(l),c=a(2115);function d(){let[e,t]=(0,c.useState)(""),[a,l]=(0,c.useState)(""),[d,o]=(0,c.useState)("Ready."),[m,h]=(0,c.useState)(""),[u,p]=(0,c.useTransition)(),[x,v]=(0,c.useState)([{role:"assistant",content:"CoPilot Symptomatologist web chat is ready. Ask about the current case or request a rewrite/summary."}]),[j,f]=(0,c.useState)(""),[y,g]=(0,c.useState)([]),[b,N]=(0,c.useState)([]),[w,k]=(0,c.useState)(""),[C,_]=(0,c.useState)([]),[S,A]=(0,c.useState)(""),[P,D]=(0,c.useState)(""),[T,R]=(0,c.useState)(""),[F,B]=(0,c.useState)([]),[I,O]=(0,c.useState)(""),[z,L]=(0,c.useState)(""),[E,K]=(0,c.useState)(""),[q,M]=(0,c.useState)(""),[U,Z]=(0,c.useState)(!1),[Q,H]=(0,c.useState)(null),[W,G]=(0,c.useState)([]),[J,$]=(0,c.useState)([]),[X,Y]=(0,c.useState)(!1),[V,ee]=(0,c.useState)(""),[et,ea]=(0,c.useState)(""),[ei,en]=(0,c.useState)(""),[es,el]=(0,c.useState)(""),[er,ec]=(0,c.useState)(""),[ed,eo]=(0,c.useState)(()=>new Date().toISOString().slice(0,10)),[em,eh]=(0,c.useState)("09:00"),[eu,ep]=(0,c.useState)(30),[ex,ev]=(0,c.useState)(!0),[ej,ef]=(0,c.useState)(!1),[ey,eg]=(0,c.useState)(""),eb=(e,t)=>{h(e instanceof Error?e.message:t)},eN=e=>{try{return new Date(e).toLocaleString()}catch(t){return e}},ew=e=>{let t=(e||"").match(/(?:Date of Birth|DOB)\s*:\s*([^\n\r]+)/i);return((null==t?void 0:t[1])||"").trim()},ek=async()=>{Y(!0),h(""),o("Loading scheduling data...");try{var e,t;let[a,i,n]=await Promise.all([(0,s.Tt)("/availability"),(0,s.Tt)("/appointments"),(0,s.Tt)("/waitlist")]);H(a),G(null!=(e=i.items)?e:[]),$(null!=(t=n.items)?t:[]),o("Scheduling data loaded.")}catch(e){eb(e,"Failed to load scheduling data.")}finally{Y(!1)}},eC=async()=>{if(Q){Y(!0),h(""),o("Saving availability...");try{let e=await (0,s.B2)("/availability",Q);H(e.availability),o("Availability saved.")}catch(e){eb(e,"Failed to save availability.")}finally{Y(!1)}}},e_=async()=>{let e=V.trim();if(!e)return void h("Patient name is required.");let t=new Date("".concat(ed,"T").concat(em)).toISOString();Y(!0),h(""),o("Creating appointment...");try{let i=await (0,s.B2)("/appointments",{patient_name:e,patient_email:et.trim(),patient_phone:ei.trim(),reason:es.trim(),notes:er.trim(),start_time:t,duration_minutes:eu,allow_waitlist:ex});if(i.waitlisted)o("Time slot was full; patient added to waitlist.");else{var a;o("Appointment created".concat((null==(a=i.appointment)?void 0:a.id)?" (".concat(i.appointment.id,")"):"","."))}await ek()}catch(e){eb(e,"Failed to create appointment.")}finally{Y(!1)}},eS=async(e,t)=>{Y(!0),h(""),o("Updating appointment ".concat(e,"..."));try{await (0,s.pb)("/appointments/".concat(e),{status:t}),o("Appointment updated: ".concat(e,".")),await ek()}catch(e){eb(e,"Failed to update appointment.")}finally{Y(!1)}},eA=async e=>{Y(!0),h(""),o("Sending reminder for ".concat(e,"..."));try{await (0,s.B2)("/appointments/".concat(e,"/send_reminder"),{}),o("Reminder sent."),await ek()}catch(e){eb(e,"Failed to send reminder.")}finally{Y(!1)}},eP=async e=>{var t,a;if(!(null==e?void 0:e.id))return;if((null!=(t=e.status)?t:"waiting")!=="waiting")return void h("Only waiting items can be converted.");let i=(null!=(a=e.preferred_start_time)?a:"").trim();if(!i)return void h("This waitlist item has no preferred start time.");Y(!0),h(""),o("Converting waitlist item ".concat(e.id,"..."));try{await (0,s.B2)("/waitlist/".concat(e.id,"/convert"),{start_time:i}),o("Waitlist item converted: ".concat(e.id,".")),await ek()}catch(e){eb(e,"Failed to convert waitlist item.")}finally{Y(!1)}},eD=e=>{t(t=>"".concat(t).concat(t.trim()?"\n\n":"").concat(e).trim())},eT=e=>{window.open(e,"_blank","noopener,noreferrer")},eR=async e=>{var t;let a=F.filter(e=>{var t;return(null!=(t=e.tags)?t:[]).every(e=>"patient-record"!==e)}).slice(0,5).map(e=>e.filename);return null!=(t=(await (0,s.B2)("/analyze_case",{note:e,reference_names:a})).analysis)?t:""},eF=e=>{var t;let a=e.intake,i=(null==(t=e.meta)?void 0:t.full_name)||(null==a?void 0:a.FullName)||"Unknown patient",n=["[Assistant intake selected] ".concat(i)];return(null==a?void 0:a.DateOfBirth)&&n.push("DOB: ".concat(a.DateOfBirth)),(null==a?void 0:a.ChiefComplaint)&&n.push("Chief complaint: ".concat(a.ChiefComplaint)),(e.intake_summary||"").trim()&&n.push("Intake summary:\n".concat((e.intake_summary||"").trim())),(e.enhanced_report||"").trim()&&n.push("Enhanced report:\n".concat((e.enhanced_report||"").trim())),{name:i,noteText:n.join("\n\n")}},eB=async()=>{h(""),o("Loading doctor records and assistant intakes...");try{var e,t,a,i,n;let[l,r]=await Promise.all([(0,s.Tt)("/patient_records"),(0,s.Tt)("/intakes")]),c=null!=(t=l.items)?t:[],d=null!=(a=r.items)?a:[];g(c),N(d),!ey&&(null==(e=d[0])?void 0:e.id)?eg(d[0].id):ey&&!d.some(e=>e.id===ey)&&eg(null!=(n=null==(i=d[0])?void 0:i.id)?n:""),o("Loaded ".concat(c.length," doctor record(s) and ").concat(d.length," assistant intake(s)."))}catch(e){eb(e,"Failed to load patient records.")}},eI=async e=>{h(""),o("Loading assistant intake ".concat(e,"..."));try{let t=await (0,s.Tt)("/intakes/".concat(e));eD(eF(t).noteText),o("Assistant intake ".concat(e," appended to doctor note."))}catch(e){eb(e,"Failed to load assistant intake.")}},eO=e=>{h(""),o("Opening assistant intake ".concat(e,"...")),p(async()=>{try{let n=await (0,s.Tt)("/intakes/".concat(e)),{name:r,noteText:c}=eF(n);t(c),ee(e=>e||r);let d=!1;if(n.intake)try{var a,i;let e=await (0,s.B2)("/documents/intake_pdf",{intake:n.intake,enhanced_report:null!=(i=n.enhanced_report)?i:"",title:"Assistant Intake Record - ".concat(r)});(null==(a=e.document)?void 0:a.stored_path)&&(eT(e.document.stored_path),d=!0)}catch(e){d=!1}let m=await eR(c);l(m),o(d?"Loaded ".concat(r,", opened patient PDF, and completed AI analysis."):"Loaded ".concat(r," and completed AI analysis."))}catch(e){eb(e,"Failed to open assistant intake for analysis.")}})},ez=async()=>{let e=!ej;ef(e),e&&(b.length||await eB())},eL=async()=>{h(""),o("Loading local references / KB...");try{var e,t,a,i;let n=await (0,s.Tt)("/train_ai/status");B(null!=(a=n.documents)?a:[]),!I&&(null==(t=n.documents)||null==(e=t[0])?void 0:e.filename)&&O(n.documents[0].filename),o("Loaded ".concat(null!=(i=n.trained_documents)?i:0," trained document(s)."))}catch(e){eb(e,"Failed to load KB status.")}},eE=async e=>{h(""),o("Extracting attachment: ".concat(e.name));try{var t;let a=new FormData;a.append("file",e);let i=await (0,s.zz)("/attachments/extract",a),n=["[Attachment: ".concat(e.name,"]"),(null==(t=i.extracted_text)?void 0:t.trim())?i.extracted_text.trim():i.message||"No text extracted."].join("\n");eD(n),o("Attachment processed: ".concat(e.name))}catch(e){eb(e,"Attachment processing failed.")}},eK=()=>{let e=j.trim();if(!e)return;h(""),o("Sending chat message...");let t=[...x,{role:"user",content:e}];v(t),f(""),p(async()=>{try{let e=await (0,s.B2)("/chat",{history:t});v(t=>{var a;return[...t,{role:"assistant",content:null!=(a=e.reply)?a:"No response."}]}),o("Chat reply received.")}catch(e){eb(e,"Chat failed.")}})},eq=async e=>{if(null==e?void 0:e.length){Z(!0),h(""),o("Training on ".concat(e.length," file(s)..."));try{for(let t of Array.from(e)){let e=new FormData;e.append("file",t),q.trim()&&e.append("tags",q.trim()),await (0,s.zz)("/train_ai/upload",e)}o("Training upload complete (".concat(e.length," file(s)).")),await eL()}catch(e){eb(e,"Train AI upload failed.")}finally{Z(!1)}}};return(0,i.jsxs)("main",{className:"shell stack","data-testid":"doctor-page",children:[(0,i.jsxs)("section",{className:"hero",children:[(0,i.jsx)("h1",{className:"doctor-hero-title",children:"Medical Doctor Workspace"}),(0,i.jsx)("p",{children:"Clinical command center for physicians: review assistant intakes, perform AI-supported case analysis, manage scheduling, generate patient documents, and maintain complete patient records for final doctor-reviewed decisions."}),(0,i.jsxs)("nav",{className:"hero-nav",children:[(0,i.jsx)(r(),{href:"/",children:"Home"}),(0,i.jsx)(r(),{href:"/assistant",children:"Assistant Portal"}),(0,i.jsx)("button",{className:"nav-chip-btn","data-testid":"doctor-refresh-kb",onClick:()=>void eL(),children:"Refresh KB"}),(0,i.jsx)("button",{className:"nav-chip-btn","data-testid":"doctor-refresh-patient-records",onClick:()=>void eB(),children:"Refresh patient/intake records"})]})]}),(0,i.jsx)(n.Z,{title:"Scheduling",subtitle:"Appointments, availability, waitlist, reminders",children:(0,i.jsxs)("div",{className:"stack",style:{gap:12},children:[(0,i.jsxs)("div",{className:"hero-nav",style:{alignItems:"center"},children:[(0,i.jsx)("button",{className:"btn ghost",onClick:()=>void ek(),disabled:X,children:X?"Loading...":"Refresh scheduling"}),(0,i.jsxs)(n.r,{children:["API: ",(0,i.jsx)("code",{children:"/appointments"}),", ",(0,i.jsx)("code",{children:"/availability"}),", ",(0,i.jsx)("code",{children:"/waitlist"})]})]}),(0,i.jsxs)("div",{className:"page-grid columns-2",children:[(0,i.jsxs)("div",{className:"stack",style:{gap:12},children:[(0,i.jsxs)("div",{className:"field-grid",children:[(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Patient name"}),(0,i.jsx)("input",{value:V,onChange:e=>ee(e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Patient email (for reminders)"}),(0,i.jsx)("input",{value:et,onChange:e=>ea(e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Patient phone"}),(0,i.jsx)("input",{value:ei,onChange:e=>en(e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Reason"}),(0,i.jsx)("input",{value:es,onChange:e=>el(e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Date"}),(0,i.jsx)("input",{type:"date",value:ed,onChange:e=>eo(e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Time"}),(0,i.jsx)("input",{type:"time",value:em,onChange:e=>eh(e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Duration (minutes)"}),(0,i.jsx)("select",{value:eu,onChange:e=>ep(Number(e.target.value)),children:[15,30,45,60].map(e=>(0,i.jsx)("option",{value:e,children:e},e))})]}),(0,i.jsx)("div",{className:"field",children:(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)("input",{type:"checkbox",checked:ex,onChange:e=>ev(e.target.checked)}),"Add to waitlist if slot is full"]})})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Notes"}),(0,i.jsx)("textarea",{value:er,onChange:e=>ec(e.target.value)})]}),(0,i.jsx)("div",{className:"hero-nav",children:(0,i.jsx)("button",{className:"btn",onClick:()=>void e_(),disabled:X,children:"Create appointment"})})]}),(0,i.jsx)("div",{className:"stack",style:{gap:12},children:(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Availability (weekly)"}),Q?(0,i.jsxs)("div",{className:"stack",style:{gap:10},children:[(0,i.jsxs)("div",{className:"field",style:{maxWidth:220},children:[(0,i.jsx)("label",{children:"Slot minutes"}),(0,i.jsx)("input",{type:"number",value:Q.slot_minutes,onChange:e=>H({...Q,slot_minutes:Number(e.target.value||15)})})]}),Q.windows.map((e,t)=>(0,i.jsxs)("div",{className:"field-grid compact-3",children:[(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Weekday (0=Mon..6=Sun)"}),(0,i.jsx)("input",{type:"number",value:e.weekday,onChange:a=>{let i=Q.windows.slice();i[t]={...e,weekday:Number(a.target.value)},H({...Q,windows:i})}})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Start"}),(0,i.jsx)("input",{type:"time",value:e.start,onChange:a=>{let i=Q.windows.slice();i[t]={...e,start:a.target.value},H({...Q,windows:i})}})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"End"}),(0,i.jsx)("input",{type:"time",value:e.end,onChange:a=>{let i=Q.windows.slice();i[t]={...e,end:a.target.value},H({...Q,windows:i})}})]})]},"".concat(e.weekday,"-").concat(t))),(0,i.jsx)("div",{className:"hero-nav",children:(0,i.jsx)("button",{className:"btn",onClick:()=>void eC(),disabled:X,children:"Save availability"})})]}):(0,i.jsx)(n.r,{children:"Click “Refresh scheduling” to load availability."})]})})]}),(0,i.jsxs)("div",{className:"page-grid columns-2",children:[(0,i.jsxs)("div",{className:"stack",style:{gap:10},children:[(0,i.jsx)("h3",{style:{margin:0},children:"Upcoming appointments"}),W.length?(0,i.jsx)("div",{className:"stack",style:{gap:10},children:W.slice(0,12).map(e=>(0,i.jsxs)("div",{className:"panel",style:{padding:12},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:e.patient_name}),(0,i.jsx)("div",{className:"small-meta",children:eN(e.start_time)}),(0,i.jsxs)("div",{className:"small-meta",children:["Status: ",e.status]})]}),(0,i.jsxs)("div",{className:"hero-nav",style:{justifyContent:"flex-end"},children:[(0,i.jsx)("button",{className:"btn ghost",onClick:()=>void eS(e.id,"checked_in"),children:"Check-in"}),(0,i.jsx)("button",{className:"btn ghost",onClick:()=>void eS(e.id,"completed"),children:"Complete"}),(0,i.jsx)("button",{className:"btn ghost",onClick:()=>void eS(e.id,"cancelled"),children:"Cancel"}),(0,i.jsx)("button",{className:"btn ghost",onClick:()=>void eA(e.id),children:"Send reminder"})]})]}),e.reason?(0,i.jsxs)("div",{className:"small-meta",children:["Reason: ",e.reason]}):null,e.patient_email?(0,i.jsxs)("div",{className:"small-meta",children:["Email: ",e.patient_email]}):null]},e.id))}):(0,i.jsx)(n.r,{children:"No appointments loaded."})]}),(0,i.jsxs)("div",{className:"stack",style:{gap:10},children:[(0,i.jsx)("h3",{style:{margin:0},children:"Waitlist"}),J.length?(0,i.jsx)("div",{className:"stack",style:{gap:10},children:J.slice(0,12).map(e=>{var t;return(0,i.jsxs)("div",{className:"panel",style:{padding:12},children:[(0,i.jsx)("strong",{children:e.patient_name}),(0,i.jsxs)("div",{className:"small-meta",children:["Status: ",e.status]}),e.preferred_start_time?(0,i.jsxs)("div",{className:"small-meta",children:["Preferred: ",eN(e.preferred_start_time)]}):null,e.reason?(0,i.jsxs)("div",{className:"small-meta",children:["Reason: ",e.reason]}):null,(0,i.jsx)("div",{className:"hero-nav",style:{justifyContent:"flex-start"},children:(0,i.jsx)("button",{className:"btn ghost",onClick:()=>void eP(e),disabled:X||(null!=(t=e.status)?t:"waiting")!=="waiting"||!e.preferred_start_time,children:"Convert to appointment"})})]},e.id)})}):(0,i.jsx)(n.r,{children:"No waitlist items."})]})]})]})}),(0,i.jsx)("div",{className:"status".concat(m?" error":""),"data-testid":"doctor-status",children:m||d}),(0,i.jsxs)("div",{className:"page-grid columns-2",children:[(0,i.jsxs)(n.Z,{title:"Doctor Note",subtitle:"Main case narrative workspace",children:[(0,i.jsxs)("div",{className:"toolbar",children:[(0,i.jsx)("button",{className:"btn","data-testid":"doctor-attach-file-label",onClick:()=>void ez(),children:"Attach assistant patient record"}),(0,i.jsxs)("label",{className:"btn ghost","data-testid":"doctor-upload-local-file-label",children:["Upload local file (PDF/Text/Image)",(0,i.jsx)("input",{hidden:!0,type:"file","data-testid":"doctor-attach-file-input",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&eE(a),e.currentTarget.value=""}})]}),(0,i.jsx)("button",{className:"btn accent","data-testid":"doctor-revise-report",disabled:u,onClick:()=>{h(""),o("Revising medical report..."),p(async()=>{try{var a;let i=await (0,s.B2)("/chat",{history:[{role:"system",content:"You are an expert medical scribe. Rewrite the doctor's note as a formal structured medical report. Keep every fact and measurement. Do not omit or invent information. If uncertain, preserve the original wording."},{role:"user",content:e}]});t(null!=(a=i.reply)?a:e),o("Doctor note revised.")}catch(e){eb(e,"Revision failed.")}})},children:"Revise Report"}),(0,i.jsx)("button",{className:"btn primary","data-testid":"doctor-analyze-case",disabled:u,onClick:()=>{h(""),o("Analyzing case..."),p(async()=>{try{let t=await eR(e);l(t),o("Case analysis complete.")}catch(e){eb(e,"Analyze failed.")}})},children:"Analyze Case"}),(0,i.jsx)("button",{className:"btn","data-testid":"doctor-save-patient-record",disabled:u,onClick:()=>{h(""),o("Saving patient record..."),p(async()=>{try{var t,a;let i=await (0,s.B2)("/patient_records",{note:e});o("Patient record saved: ".concat(null!=(a=null==(t=i.record)?void 0:t.filename)?a:"")),await eB(),await eL()}catch(e){eb(e,"Save patient record failed.")}})},children:"Save Patient Record"}),(0,i.jsx)("button",{className:"btn","data-testid":"doctor-generate-patient-pdf",disabled:u,onClick:()=>{let t=e.trim();if(!t)return void h("Doctor note is empty.");h(""),o("Generating patient record PDF..."),p(async()=>{try{let e=ew(t),a=await (0,s.B2)("/documents/patient_record_pdf",{note:t,title:"Doctor Patient Record",patient_name:V.trim(),patient_dob:e,source_role:"doctor"});o("Patient record PDF ready: ".concat(a.document.filename)),eT(a.document.stored_path)}catch(e){eb(e,"Failed to generate patient record PDF.")}})},children:"Generate Patient Record PDF"}),(0,i.jsx)("button",{className:"btn","data-testid":"doctor-generate-certificate-pdf",disabled:u,onClick:()=>{var t,a,i,n,l;let r=V.trim(),c=(window.prompt("Patient name",r)||"").trim();if(!c)return void h("Patient name is required to generate a medical certificate.");let d=null!=(t=window.prompt("Diagnosis / impression",es||""))?t:"",m=null!=(a=window.prompt("Recommendations","Patient is advised to follow up and rest as needed."))?a:"",u=ew(e),x=(window.prompt("Date of birth (optional)",u)||"").trim(),v=window.prompt("Rest days (optional integer)","1"),j=null!=(i=window.prompt("Doctor name",""))?i:"",f=null!=(n=window.prompt("Doctor license (optional)",""))?n:"",y=null!=(l=window.prompt("Clinic / facility name",""))?l:"",g=v&&/^\d+$/.test(v.trim())?Number(v.trim()):null;h(""),o("Generating medical certificate PDF..."),p(async()=>{try{let t=await (0,s.B2)("/documents/medical_certificate_pdf",{patient_name:c,patient_dob:x,diagnosis:d,recommendations:m,rest_days:g,doctor_name:j,doctor_license:f,clinic_name:y,additional_notes:e.slice(0,1200)});o("Medical certificate PDF ready: ".concat(t.document.filename)),eT(t.document.stored_path)}catch(e){eb(e,"Failed to generate medical certificate PDF.")}})},children:"Generate Medical Certificate PDF"}),(0,i.jsx)("button",{className:"btn","data-testid":"doctor-clear-note",onClick:()=>t(""),children:"Clear"})]}),ej?(0,i.jsxs)("div",{className:"panel stack",style:{marginTop:12,padding:12,gap:10},"data-testid":"doctor-assistant-intake-picker",children:[(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{htmlFor:"assistantIntakeSelect",children:"Assistant patient intake"}),(0,i.jsxs)("select",{id:"assistantIntakeSelect","data-testid":"doctor-assistant-intake-select",value:ey,onChange:e=>eg(e.target.value),children:[(0,i.jsx)("option",{value:"",children:"Select assistant patient record..."}),b.map(e=>(0,i.jsxs)("option",{value:e.id,children:[e.full_name||"(Unnamed patient)"," | DOB: ",e.date_of_birth||"-"," |"," ",e.created_at]},e.id))]})]}),(0,i.jsxs)("div",{className:"toolbar",children:[(0,i.jsx)("button",{className:"btn primary","data-testid":"doctor-open-selected-intake",disabled:u||!ey,onClick:()=>eO(ey),children:"Open Selected Patient + Analyze"}),(0,i.jsx)("button",{className:"btn","data-testid":"doctor-refresh-intake-picker",disabled:u,onClick:()=>void eB(),children:"Refresh patient records"})]}),(0,i.jsx)(n.r,{children:"Selecting a patient loads the assistant intake into Doctor Note, opens a patient PDF, and runs AI Analysis for doctor review."})]}):null,(0,i.jsx)("textarea",{"data-testid":"doctor-note",value:e,onChange:e=>t(e.target.value),placeholder:"Paste or dictate doctor note here...",style:{minHeight:360,marginTop:12}})]}),(0,i.jsx)(n.Z,{title:"AI Analysis",subtitle:"Output from /analyze_case (clinical support only; doctor review required)",children:(0,i.jsx)("div",{className:"pre","data-testid":"doctor-analysis-output",style:{minHeight:428},children:a||"Case analysis output will appear here."})})]}),(0,i.jsxs)("div",{className:"page-grid columns-2",children:[(0,i.jsxs)(n.Z,{title:"AI Chat",subtitle:"Uses the same backend /chat contract as WinForms",children:[(0,i.jsx)("div",{className:"chat-box","data-testid":"doctor-chat-box",children:x.map((e,t)=>(0,i.jsxs)("p",{className:"chat-line",children:[(0,i.jsxs)("strong",{children:[e.role,":"]})," ",e.content]},"".concat(e.role,"-").concat(t)))}),(0,i.jsxs)("div",{className:"field",style:{marginTop:12},children:[(0,i.jsx)("label",{htmlFor:"chatInput",children:"Message"}),(0,i.jsx)("textarea",{id:"chatInput","data-testid":"doctor-chat-input",value:j,onChange:e=>f(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),eK())},placeholder:"Ask a question about the case (Ctrl/Cmd+Enter to send)"})]}),(0,i.jsxs)("div",{className:"toolbar",children:[(0,i.jsx)("button",{className:"btn primary","data-testid":"doctor-chat-send",disabled:u,onClick:eK,children:"Send Chat"}),(0,i.jsx)("button",{className:"btn","data-testid":"doctor-chat-reset",onClick:()=>v([{role:"assistant",content:"CoPilot Symptomatologist web chat is ready. Ask about the current case or request a rewrite/summary."}]),children:"Reset Chat"})]})]}),(0,i.jsxs)(n.Z,{title:"Medication Lookup (RxNav)",children:[(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{htmlFor:"rxQuery",children:"Medication name"}),(0,i.jsx)("input",{id:"rxQuery","data-testid":"doctor-rx-query",value:w,onChange:e=>k(e.target.value),placeholder:"e.g., metformin"})]}),(0,i.jsx)("div",{className:"toolbar",children:(0,i.jsx)("button",{className:"btn","data-testid":"doctor-rx-lookup",disabled:u,onClick:()=>{w.trim()&&(h(""),o("Looking up medication in RxNav..."),p(async()=>{try{var e,t,a;let i=await (0,s.Tt)("/rxnav_lookup?query=".concat(encodeURIComponent(w.trim())));_(null!=(t=i.items)?t:[]),o("RxNav lookup returned ".concat(null!=(a=null==(e=i.items)?void 0:e.length)?a:0," item(s)."))}catch(e){eb(e,"RxNav lookup failed.")}}))},children:"Lookup"})}),(0,i.jsx)("div",{className:"list","data-testid":"doctor-rx-results",children:0===C.length?(0,i.jsx)("div",{className:"list-item",children:(0,i.jsx)(n.r,{children:"RxNav results will appear here."})}):C.map(e=>(0,i.jsx)("div",{className:"list-item",children:e},e))})]})]}),(0,i.jsxs)("div",{className:"page-grid columns-2",children:[(0,i.jsxs)(n.Z,{title:"Local Knowledge Base (Train + Ask)",children:[(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{htmlFor:"trainTags",children:"Train AI tags (comma-separated)"}),(0,i.jsx)("input",{id:"trainTags","data-testid":"doctor-train-tags",value:q,onChange:e=>M(e.target.value),placeholder:"Cardio, Endocrine, SOAP, Protocol"})]}),(0,i.jsxs)("div",{className:"toolbar",children:[(0,i.jsxs)("label",{className:"btn","data-testid":"doctor-train-upload-label",children:[U?"Uploading...":"Train / Upload References",(0,i.jsx)("input",{hidden:!0,type:"file","data-testid":"doctor-train-upload-input",multiple:!0,accept:".pdf,.txt,.md",onChange:e=>{eq(e.target.files),e.currentTarget.value=""}})]}),(0,i.jsx)("button",{className:"btn","data-testid":"doctor-refresh-kb-list",onClick:()=>void eL(),children:"Refresh KB List"})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{htmlFor:"kbSelect",children:"Reference file"}),(0,i.jsxs)("select",{id:"kbSelect","data-testid":"doctor-kb-select",value:I,onChange:e=>O(e.target.value),children:[(0,i.jsx)("option",{value:"",children:"Select a reference file..."}),F.filter(e=>{var t;return!(null!=(t=e.tags)?t:[]).includes("patient-record")}).map(e=>(0,i.jsx)("option",{value:e.filename,children:e.filename},e.id))]})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{htmlFor:"kbQuestion",children:"Question for selected file"}),(0,i.jsx)("textarea",{id:"kbQuestion","data-testid":"doctor-kb-question",value:z,onChange:e=>L(e.target.value),placeholder:"How is this reference relevant to the current case?"})]}),(0,i.jsx)("div",{className:"toolbar",children:(0,i.jsx)("button",{className:"btn primary","data-testid":"doctor-kb-ask",disabled:u||!I,onClick:()=>{I&&(h(""),o("Querying ".concat(I,"...")),p(async()=>{try{var e;let t=await (0,s.B2)("/ask_pdf",{filename:I,history:[{role:"user",content:z||"Summarize relevance to this case"}]});K(null!=(e=t.answer)?e:""),o("KB answer received from ".concat(I,"."))}catch(e){eb(e,"KB query failed.")}}))},children:"Ask Selected Reference"})}),(0,i.jsx)("div",{className:"pre","data-testid":"doctor-kb-answer",children:E||"KB answer output will appear here."}),(0,i.jsxs)(n.r,{children:["Trained document count: ",F.filter(e=>{var t;return!(null!=(t=e.tags)?t:[]).includes("patient-record")}).length]})]}),(0,i.jsxs)(n.Z,{title:"Medical References (PubMed + ClinicalTrials + RxNav)",children:[(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{htmlFor:"refQuery",children:"Keywords / condition / diagnosis"}),(0,i.jsx)("input",{id:"refQuery","data-testid":"doctor-ref-query",value:S,onChange:e=>A(e.target.value),placeholder:"e.g., diabetic ketoacidosis management adult"})]}),(0,i.jsxs)("div",{className:"toolbar",children:[(0,i.jsx)("button",{className:"btn accent","data-testid":"doctor-ref-fetch",disabled:u,onClick:()=>{S.trim()&&(h(""),o("Fetching medical references..."),p(async()=>{try{var e,t;let a=await (0,s.B2)("/medical_references",{query:S,max_pubmed:6,max_trials:5,max_rxnorm:15,summarize:!0,max_summary_paragraphs:3});D(null!=(e=a.summary_text)?e:""),R(null!=(t=a.report_text)?t:""),o("Medical references report ready.")}catch(e){eb(e,"Medical references lookup failed.")}}))},children:"Fetch References"}),(0,i.jsx)("button",{className:"btn","data-testid":"doctor-ref-clear",onClick:()=>{D(""),R("")},children:"Clear"})]}),(0,i.jsx)("div",{className:"pre","data-testid":"doctor-ref-summary",children:P||"AI evidence summary will appear here."}),(0,i.jsx)("div",{className:"pre","data-testid":"doctor-ref-report",style:{maxHeight:360},children:T||"Detailed references report will appear here."})]})]}),(0,i.jsx)(n.Z,{title:"Saved Patient Records",subtitle:"Doctor records plus assistant intakes from host storage",children:(0,i.jsxs)("div",{className:"stack",style:{gap:12},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{style:{margin:0},children:"Doctor Records"}),(0,i.jsx)("div",{className:"list","data-testid":"doctor-patient-records-list",children:0===y.length?(0,i.jsx)("div",{className:"list-item",children:(0,i.jsx)(n.r,{children:"No doctor records loaded yet."})}):y.map(e=>(0,i.jsxs)("div",{className:"list-item","data-testid":"doctor-patient-record-item",children:[(0,i.jsx)("strong",{children:e.title}),(0,i.jsx)(n.r,{children:e.filename}),(0,i.jsx)(n.r,{children:e.created_at}),(0,i.jsx)("div",{className:"toolbar",children:(0,i.jsx)("button",{className:"btn","data-testid":"doctor-append-record-".concat(e.id),onClick:()=>eD("[Patient record selected]\n".concat(e.title,"\n").concat(e.filename)),children:"Append Reference to Note"})})]},e.id))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{style:{margin:0},children:"Assistant Intakes"}),(0,i.jsx)("div",{className:"list","data-testid":"doctor-intake-records-list",children:0===b.length?(0,i.jsx)("div",{className:"list-item",children:(0,i.jsx)(n.r,{children:"No assistant intakes loaded yet."})}):b.map(e=>(0,i.jsxs)("div",{className:"list-item","data-testid":"doctor-intake-record-item",children:[(0,i.jsx)("strong",{children:e.full_name||"(Unnamed patient)"}),(0,i.jsxs)(n.r,{children:["DOB: ",e.date_of_birth||"-"]}),(0,i.jsxs)(n.r,{children:["Chief complaint: ",e.chief_complaint||"-"]}),(0,i.jsx)(n.r,{children:e.created_at}),(0,i.jsxs)("div",{className:"toolbar",children:[(0,i.jsx)("button",{className:"btn","data-testid":"doctor-append-intake-".concat(e.id),onClick:()=>void eI(e.id),children:"Append Intake to Note"}),(0,i.jsx)("button",{className:"btn primary","data-testid":"doctor-open-analyze-intake-".concat(e.id),onClick:()=>eO(e.id),children:"Open + Analyze"})]})]},e.id))})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[874,441,684,358],()=>t(4872)),_N_E=e.O()}]);